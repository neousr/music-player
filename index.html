<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Julio C√©sar">
    <meta name="keywords"
        content="Audio Player, Music Player, Web Player, Music APP, Reproductor de M√∫sica, Reproductor de Audio, Reproductor Web">
    <link rel="shortcut icon" href="img/neobte_logo.png" type="image/png" sizes="16x16 32x32">
    <title>Neobte - Music Player</title>

    <style>
        :root {
            --color: #39FF14;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, Helvetica, sans-serif;
        }

        body {
            font-size: 13.333px;
            /* 1 pulgada = 2.54cm = 96px */
            /* margin: 96px; */
            margin: 1rem;
            background-color: #0d1117;
            color: #dee2e6;
        }

        .container {
            width: 100%;
            max-width: 640px;
            padding-right: calc(1.5rem * .5);
            padding-left: calc(1.5rem * .5);
            margin-right: auto;
            margin-left: auto;
        }

        /* Input range styling */
        .slider {
            -webkit-appearance: none;
            width: 100%;
            margin: 0;
            background: transparent;
            /* height: 4px; */
        }

        .slider:focus {
            outline: none;
        }

        /* Google Chrome */
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            margin-top: -5px;
            height: 13px;
            width: 13px;
            border-radius: 50%;
            background-color: var(--color);
            cursor: pointer;
        }

        .slider::-webkit-slider-runnable-track {
            height: 3px;
            cursor: pointer;
            background-color: var(--color);
            border-radius: 2px;
        }

        .slider:focus::-webkit-slider-runnable-track {
            background: #fff;
        }

        /* Mozilla Firefox */
        .slider::-moz-range-thumb {
            height: 13px;
            width: 13px;
            border: none;
            border-radius: 50%;
            background-color: var(--color);
            cursor: pointer;
        }

        .slider::-moz-range-progress {
            background-color: var(--color);
            height: 3px;
            border-radius: 2px;
            cursor: pointer;
        }

        .slider::-moz-range-track {
            height: 3px;
            cursor: pointer;
            background-color: #fff;
            border-radius: 2px;
        }

        /* End input range styling */

        .flex {
            display: flex;
            align-items: center;
        }

        .center {
            justify-content: center;
        }

        .space-between {
            justify-content: space-between;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .playlist-container {
            height: 272px;
            overflow-y: auto;
            overflow-x: hidden;
            /* box-shadow: inset 0 0 3rem rgba(40, 48, 65, 1); */
        }

        .playing {
            background-color: #283041 !important;
            color: var(--color);
            font-weight: bold;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            user-select: none;
            table-layout: fixed;
            /* font-size: .75rem; */
        }

        .table tr {
            cursor: pointer;
        }

        .table tr:hover {
            /* background-color: #283041; */
        }

        .table td {
            padding: .875rem .25rem;
        }

        .table tr td:nth-child(1) {
            width: 14%;
        }

        .table tr td.song-number::before {
            /* content: url(icons/classic/center/download.svg);
            height: 1.5em;
            width: 1.5em;
            display: inline-block;
            vertical-align: middle; */
            /* opacity: 0; */
            /* transition: opacity 0.2s; */
        }

        .table tr td.song-number:hover {
            /* color: transparent; */
        }

        .table tr td:nth-child(2) {
            width: 60%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .table tr td:nth-child(3) {
            width: 18%;
            text-align: right;
        }

        .table tr td:nth-child(4) {
            width: 8%;
            text-align: right;
        }

        button {
            background: none;
            border: none;
            outline: none;
            font-size: .875rem;
            /* Firefox => 1px 4px; chrome => 1px 6px */
            padding: 0;
            display: inline-flex;
            cursor: pointer;
            transition-duration: 0.4s;
            color: #dee2e6;
        }

        #play-btn {
            font-size: 1rem;
            width: 38px;
            height: 38px;
            background-color: #dee2e6;
            color: #0d1117;
            aspect-ratio: 1/1;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        select {
            width: 100%;
            padding: .25rem;
            text-align: center;
            display: inline-block;
            border: none;
            border-radius: .25rem;
            background-color: #283041;
            color: #dee2e6;
            outline: none;
        }

        .icon {
            height: 1.5em;
            width: auto;
            vertical-align: middle;
        }

        .hidden {
            display: none;
        }

        .visible {
            display: inline;
        }

        .fs-12 {
            font-size: .75rem;
        }

        .fs-14 {
            font-size: .875rem;
        }

        .mb-1 {
            margin-bottom: 1rem;
        }

        /* Definici√≥n de la animaci√≥n para el desplazamiento */
        @keyframes slideIn {
            0% {
                transform: translateX(100%);
                /* Comienza fuera de la pantalla por la derecha */
            }

            100% {
                transform: translateX(-100%);
                /* Se mueve hacia fuera de la pantalla por la izquierda */
            }
        }

        /* Dropdown styles */
        .dropdown-btn {
            background-color: transparent;
            border: none;
            outline: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: #f1f1f1;
            min-width: 152px;
            overflow: auto;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-content button {
            display: inline-flex;
            align-items: center;
            padding: 12px 16px;
            background-color: transparent;
            border: none;
            outline: none;
            cursor: pointer;
            min-width: 152px;
            transition-duration: 0.4s;
            color: #0d1117;
        }

        .dropdown-content button:hover {
            background-color: #ddd;
        }

        /* End dropdown styles */
    </style>
</head>

<body>

    <header class="text-center" style="margin-top: 1.5rem">
        <h1 style="font-size: 1.25rem;font-weight: 400;" class="mb-1">Music Player</h1>
        <!-- <p>Melod√≠a, ritmo y armon√≠a, combinados.<br>Pon√© play <span style="color: var(--color);">
                Play icon
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="icon">
                    <path fill="currentColor"
                        d="M187.2 100.9C174.8 94.1 159.8 94.4 147.6 101.6C135.4 108.8 128 121.9 128 136L128 504C128 518.1 135.5 531.2 147.6 538.4C159.7 545.6 174.8 545.9 187.2 539.1L523.2 355.1C536 348.1 544 334.6 544 320C544 305.4 536 291.9 523.2 284.9L187.2 100.9z" />
                </svg>
            </span> a tu mundo.</p> -->
    </header>

    <main class="container">

        <div style="padding: 0 .25rem;">

            <!-- Song Info -->
            <div class="text-center" style="margin: 1.25rem 0;position: relative;overflow: hidden;">
                <p id="artist" style="white-space: nowrap;animation: none;">Nada esta
                    sonando...</p>
                <!-- <h3 id="title" style="font-weight: 500;"></h3> -->
            </div>
            <!-- Current time slider -->
            <div class="mb-1">
                <div class="flex space-between fs-12" style="line-height: 8px;">
                    <span id="current-time">0:00</span>
                    <span id="countdown">-0:00</span>
                    <span id="duration">0:00</span>
                </div>
                <input type="range" id="current-time-slider" class="slider" min="0" max="100" value="0" step=".01"
                    disabled>

            </div>

            <!-- Controls -->
            <div class="mb-1 flex space-between">
                <!-- Shuffle btn -->
                <button id="shuffle-btn" title="Activar reproducci√≥n aleatoria">
                    <!-- Shuffle icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="50 0 640 640" class="icon">
                        <path fill="currentColor"
                            d="M467.8 98.4C479.8 93.4 493.5 96.2 502.7 105.3L566.7 169.3C572.7 175.3 576.1 183.4 576.1 191.9C576.1 200.4 572.7 208.5 566.7 214.5L502.7 278.5C493.5 287.7 479.8 290.4 467.8 285.4C455.8 280.4 448 268.9 448 256L448 224L416 224C405.9 224 396.4 228.7 390.4 236.8L358 280L318 226.7L339.2 198.4C357.3 174.2 385.8 160 416 160L448 160L448 128C448 115.1 455.8 103.4 467.8 98.4zM218 360L258 413.3L236.8 441.6C218.7 465.8 190.2 480 160 480L96 480C78.3 480 64 465.7 64 448C64 430.3 78.3 416 96 416L160 416C170.1 416 179.6 411.3 185.6 403.2L218 360zM502.6 534.6C493.4 543.8 479.7 546.5 467.7 541.5C455.7 536.5 448 524.9 448 512L448 480L416 480C385.8 480 357.3 465.8 339.2 441.6L185.6 236.8C179.6 228.7 170.1 224 160 224L96 224C78.3 224 64 209.7 64 192C64 174.3 78.3 160 96 160L160 160C190.2 160 218.7 174.2 236.8 198.4L390.4 403.2C396.4 411.3 405.9 416 416 416L448 416L448 384C448 371.1 455.8 359.4 467.8 354.4C479.8 349.4 493.5 352.2 502.7 361.3L566.7 425.3C572.7 431.3 576.1 439.4 576.1 447.9C576.1 456.4 572.7 464.5 566.7 470.5L502.7 534.5z" />
                        <circle r="50" cx="120" cy="320" fill="currentColor" class="hidden"></circle>
                    </svg>
                </button>
                <!-- Backward btn -->
                <button id="backward-btn" title="Anterior">
                    <!-- Backward-step icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="icon">
                        <path fill="currentColor"
                            d="M491 100.8C478.1 93.8 462.3 94.5 450 102.6L192 272.1L192 128C192 110.3 177.7 96 160 96C142.3 96 128 110.3 128 128L128 512C128 529.7 142.3 544 160 544C177.7 544 192 529.7 192 512L192 367.9L450 537.5C462.3 545.6 478 546.3 491 539.3C504 532.3 512 518.8 512 504.1L512 136.1C512 121.4 503.9 107.9 491 100.9z" />
                    </svg>
                </button>
                <!-- Play/pause btn -->
                <button id="play-btn" title="Reproducir">
                    <!-- Play icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="icon">
                        <path fill="currentColor"
                            d="M187.2 100.9C174.8 94.1 159.8 94.4 147.6 101.6C135.4 108.8 128 121.9 128 136L128 504C128 518.1 135.5 531.2 147.6 538.4C159.7 545.6 174.8 545.9 187.2 539.1L523.2 355.1C536 348.1 544 334.6 544 320C544 305.4 536 291.9 523.2 284.9L187.2 100.9z" />
                    </svg>
                    <!-- Pause icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="icon hidden">
                        <path fill="currentColor"
                            d="M176 96C149.5 96 128 117.5 128 144L128 496C128 522.5 149.5 544 176 544L240 544C266.5 544 288 522.5 288 496L288 144C288 117.5 266.5 96 240 96L176 96zM400 96C373.5 96 352 117.5 352 144L352 496C352 522.5 373.5 544 400 544L464 544C490.5 544 512 522.5 512 496L512 144C512 117.5 490.5 96 464 96L400 96z" />
                    </svg>
                </button>
                <!-- Forward btn -->
                <button id="forward-btn" title="Siguente">
                    <!-- Forward-step icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="icon">
                        <path fill="currentColor"
                            d="M149 100.8C161.9 93.8 177.7 94.5 190 102.6L448 272.1L448 128C448 110.3 462.3 96 480 96C497.7 96 512 110.3 512 128L512 512C512 529.7 497.7 544 480 544C462.3 544 448 529.7 448 512L448 367.9L190 537.5C177.7 545.6 162 546.3 149 539.3C136 532.3 128 518.7 128 504L128 136C128 121.3 136.1 107.8 149 100.8z" />
                    </svg>
                </button>
                <!-- Repeat btn -->
                <button id="repeat-btn" title="Repetir playlist">
                    <!-- Repeat icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="-50 0 640 640" class="icon">
                        <path fill="currentColor"
                            d="M534.6 182.6C547.1 170.1 547.1 149.8 534.6 137.3L470.6 73.3C461.4 64.1 447.7 61.4 435.7 66.4C423.7 71.4 416 83.1 416 96L416 128L256 128C150 128 64 214 64 320C64 337.7 78.3 352 96 352C113.7 352 128 337.7 128 320C128 249.3 185.3 192 256 192L416 192L416 224C416 236.9 423.8 248.6 435.8 253.6C447.8 258.6 461.5 255.8 470.7 246.7L534.7 182.7zM105.4 457.4C92.9 469.9 92.9 490.2 105.4 502.7L169.4 566.7C178.6 575.9 192.3 578.6 204.3 573.6C216.3 568.6 224 556.9 224 544L224 512L384 512C490 512 576 426 576 320C576 302.3 561.7 288 544 288C526.3 288 512 302.3 512 320C512 390.7 454.7 448 384 448L224 448L224 416C224 403.1 216.2 391.4 204.2 386.4C192.2 381.4 178.5 384.2 169.3 393.3L105.3 457.3z" />
                        <circle r="50" cx="320" cy="320" fill="currentColor" class="hidden"></circle>
                    </svg>
                    <!-- Repeat-1 icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="-50 0 640 640" class="icon hidden">
                        <path fill="currentColor"
                            d="M534.6 137.4C547.1 149.9 547.1 170.2 534.6 182.7L470.6 246.7C461.4 255.9 447.7 258.6 435.7 253.6C423.7 248.6 416 236.9 416 224L416 192L256 192C185.3 192 128 249.3 128 320C128 337.7 113.7 352 96 352C78.3 352 64 337.7 64 320C64 214 150 128 256 128L416 128L416 96C416 83.1 423.8 71.4 435.8 66.4C447.8 61.4 461.5 64.2 470.7 73.3L534.7 137.3zM105.4 502.6C92.9 490.1 92.9 469.8 105.4 457.3L169.4 393.3C178.6 384.1 192.3 381.4 204.3 386.4C216.3 391.4 224 403.1 224 416L224 448L384 448C454.7 448 512 390.7 512 320C512 302.3 526.3 288 544 288C561.7 288 576 302.3 576 320C576 426 490 512 384 512L224 512L224 544C224 556.9 216.2 568.6 204.2 573.6C192.2 578.6 178.5 575.8 169.3 566.7L105.3 502.7zM352 280L352 360C352 373.3 341.3 384 328 384C314.7 384 304 373.3 304 360L304 312C294 312 284.6 305.6 281.2 295.6C277 283 283.8 269.4 296.4 265.2L320.4 257.2C327.7 254.8 335.8 256 342 260.5C348.2 265 352 272.3 352 280z" />
                    </svg>
                </button>
            </div>

            <!-- Volume slider -->
            <div class="mb-1 flex">
                <div style="width: 10%;">
                    <button class="flex" id="volume-btn" title="Silenciar" style="font-size: .75rem;">
                        <!-- Volume-high icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="icon">
                            <path fill="currentColor"
                                d="M533.6 96.5C523.3 88.1 508.2 89.7 499.8 100C491.4 110.3 493 125.4 503.3 133.8C557.5 177.8 592 244.8 592 320C592 395.2 557.5 462.2 503.3 506.3C493 514.7 491.5 529.8 499.8 540.1C508.1 550.4 523.3 551.9 533.6 543.6C598.5 490.7 640 410.2 640 320C640 229.8 598.5 149.2 533.6 96.5zM473.1 171C462.8 162.6 447.7 164.2 439.3 174.5C430.9 184.8 432.5 199.9 442.8 208.3C475.3 234.7 496 274.9 496 320C496 365.1 475.3 405.3 442.8 431.8C432.5 440.2 431 455.3 439.3 465.6C447.6 475.9 462.8 477.4 473.1 469.1C516.3 433.9 544 380.2 544 320.1C544 260 516.3 206.3 473.1 171.1zM412.6 245.5C402.3 237.1 387.2 238.7 378.8 249C370.4 259.3 372 274.4 382.3 282.8C393.1 291.6 400 305 400 320C400 335 393.1 348.4 382.3 357.3C372 365.7 370.5 380.8 378.8 391.1C387.1 401.4 402.3 402.9 412.6 394.6C434.1 376.9 448 350.1 448 320C448 289.9 434.1 263.1 412.6 245.5zM80 416L128 416L262.1 535.2C268.5 540.9 276.7 544 285.2 544C304.4 544 320 528.4 320 509.2L320 130.8C320 111.6 304.4 96 285.2 96C276.7 96 268.5 99.1 262.1 104.8L128 224L80 224C53.5 224 32 245.5 32 272L32 368C32 394.5 53.5 416 80 416z" />
                        </svg>
                        <!-- Volume-xmark icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="icon hidden">
                            <path fill="currentColor"
                                d="M80 416L128 416L262.1 535.2C268.5 540.9 276.7 544 285.2 544C304.4 544 320 528.4 320 509.2L320 130.8C320 111.6 304.4 96 285.2 96C276.7 96 268.5 99.1 262.1 104.8L128 224L80 224C53.5 224 32 245.5 32 272L32 368C32 394.5 53.5 416 80 416zM399 239C389.6 248.4 389.6 263.6 399 272.9L446 319.9L399 366.9C389.6 376.3 389.6 391.5 399 400.8C408.4 410.1 423.6 410.2 432.9 400.8L479.9 353.8L526.9 400.8C536.3 410.2 551.5 410.2 560.8 400.8C570.1 391.4 570.2 376.2 560.8 366.9L513.8 319.9L560.8 272.9C570.2 263.5 570.2 248.3 560.8 239C551.4 229.7 536.2 229.6 526.9 239L479.9 286L432.9 239C423.5 229.6 408.3 229.6 399 239z" />
                        </svg>
                    </button>
                </div>
                <input type="range" id="volume-slider" class="slider" min="0" max="100" value="100" step="1"
                    style="width: 80%;">
                <span id="volume-display" class="text-right fs-12" style="width: 10%;">100</span>
            </div>

        </div>

        <!-- Select Playlist -->
        <div class="text-center" style="margin-bottom: .5rem;">
            <select id="playlist">
                <option value="">üéß Playlists</option>
                <option value="my_playlist">ü§∑‚Äç‚ôÇÔ∏è Julify</option>
                <option value="rock">üé∏ Rock</option>
                <option value="salsa">üï∫ Salsa</option>
            </select>
            <span id="playlist-duration-display" class="fs-12 hidden"></span>
        </div>

        <!-- Table Playlist -->
        <div class="playlist-container">
            <table class="table">
                <tbody id="tbody"></tbody>
            </table>
        </div>

    </main>

    <footer class="text-center fs-12" style="margin-top: 1.5rem;">
        <p>Copyright ¬©Ô∏è 2025 | Made with ‚ù§Ô∏è by Julio</p>
    </footer>

    <script>

        "use strict";

        const d = document;

        const currentTimeSlider = d.getElementById("current-time-slider");
        const currentTime = d.getElementById("current-time");
        const duration = d.getElementById("duration");
        const countdown = d.getElementById("countdown");

        const volumeSlider = d.getElementById("volume-slider");
        const volumeBtn = d.getElementById("volume-btn");
        const volumeDisplay = d.getElementById("volume-display");

        const artist = d.getElementById("artist");
        const parentElementOffsetWidth = artist.parentElement.offsetWidth;
        const title = d.getElementById("title");

        const playBtn = d.getElementById("play-btn");
        const forwardBtn = d.getElementById("forward-btn");
        const backwardBtn = d.getElementById("backward-btn");
        const repeatBtn = d.getElementById("repeat-btn");
        const shuffleBtn = d.getElementById("shuffle-btn");

        const selectPlaylist = d.getElementById("playlist");

        const tbody = d.getElementById("tbody");

        const downloadLink = d.createElement('a');

        let songs, songsCopy, numberOfSongs, songIndex;/*= [
            { id: 1, artist: "Pedro Su√°rez V√©rtiz", title: "Te siento de s√≥lo pensar", url: "https://neobte.github.io/music-player/audio/rock/Pedro%20Su%C3%A1rez%20V%C3%A9rtiz%20-%20Te%20siento%20de%20s%C3%B3lo%20pensar.m4a" },
            { id: 2, artist: "Bob Marley", title: "Jamming", url: "audio/Bob%20Marley%20-%20Jamming.m4a" },
            { id: 3, artist: "Michael Sembello", title: "Maniac", url: "audio/Michael%20Sembello%20-%20Maniac.m4a" },
            { id: 4, artist: "Virus", title: "Sin disfraz", url: "audio/Virus - Sin disfraz.m4a" },
            { id: 5, artist: "Mar de Copas", title: "Suna", url: "audio/Mar de Copas - Suna.m4a" },
        ];*/

        let audioPlayer = new Audio();
        // audioPlayer.controls = true;
        // d.body.appendChild(audioPlayer);

        const audioSourcePath = "https://neobte.github.io/music-player/audio/";

        const validOptions = ["my_playlist", "rock", "salsa"];

        let repeatState = 0, isRepeatAll = false;
        let isShuffle = false;
        let currentVolume = 1; // 1 = 100 %
        let playlistName;
        let previousRowActive = null;
        let previousSelectedPlaylist = "";

        d.addEventListener("DOMContentLoaded", e => {
            init();
        })

        const init = () => {

            // Al recargar la p√°gina reseteamos los valores
            selectPlaylist.value = "";
            currentTimeSlider.disabled = true;
            currentTimeSlider.value = 0;
            volumeSlider.value = 100;

            selectPlaylist.addEventListener("change", e => {
                if (selectPlaylist.selectedIndex === 0) return;
                playlistName = selectPlaylist.value;
                if (!validOptions.includes(playlistName)) return;
                if (previousSelectedPlaylist === playlistName) return;

                previousSelectedPlaylist = playlistName;
                sendHttpRequest("GET", audioSourcePath + playlistName + "/playlist.json", null, handleResponse);
            });

        }

        const handleResponse = response => {
            // songs = JSON.parse(response).slice(0, 7);
            songs = JSON.parse(response);
            // console.table(songs);
            songsCopy = [...songs];
            numberOfSongs = songs.length;
            songIndex = 0;

            // ¬øPodemos eliminar esta condici√≥n? La respuesta es NO
            if (songIndex < numberOfSongs) {
                // 1. Mostramos la playlist
                displayPlaylist(songs);
                // 2. Cargamos el √≠ndice cero de forma predeterminada
                loadSong(songIndex);
                // 3. Reproducimos
                playAudio();

                d.getElementById("playlist-duration-display").textContent = getPlaylistDuration(songs);

                if (currentTimeSlider.disabled) {
                    currentTimeSlider.disabled = false;
                }

                if (isShuffle) {
                    // console.log("entramos");
                    isShuffle = false;
                    shuffleBtn.click();
                }
            }
        };

        const loadSong = songIndex => {
            audioPlayer.src = audioSourcePath + playlistName + "/" + songs[songIndex].name;
            audioPlayer.load();
            audioPlayer.preload = "metadata";
            audioPlayer.dataset.songId = songs[songIndex].id;
            artist.textContent = rmExt(songs[songIndex].name);
            // title.textContent = songs[songIndex].title;

            setAnimation(artist);
        }

        const setAnimation = title => {
            if (title.scrollWidth > parentElementOffsetWidth) {
                title.style.animation = "slideIn 16s linear infinite";
            } else {
                title.style.animation = "none";
            }
        }

        // "1\tSi ya no est√°s - 3-2 Get Funky\t4:29"
        const displayPlaylist = songs => {
            tbody.textContent = "";
            const fragment = d.createDocumentFragment();
            for (let idx = 0; idx < numberOfSongs; idx++) {
                const tr = d.createElement("tr");
                tr.dataset.songId = songs[idx].id;
                tr.innerHTML = `<td>${idx + 1}</td>
                <td>${parseName(songs[idx].name)}</td>
                <td>${formatTime(songs[idx].duration)}</td>
                <td>
            <div class="dropdown">
                <button class="dropdown-btn">
                    <!-- Ellipsis vertical icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="icon">
                        <path fill="currentColor"
                            d="M320 208C289.1 208 264 182.9 264 152C264 121.1 289.1 96 320 96C350.9 96 376 121.1 376 152C376 182.9 350.9 208 320 208zM320 432C350.9 432 376 457.1 376 488C376 518.9 350.9 544 320 544C289.1 544 264 518.9 264 488C264 457.1 289.1 432 320 432zM376 320C376 350.9 350.9 376 320 376C289.1 376 264 350.9 264 320C264 289.1 289.1 264 320 264C350.9 264 376 289.1 376 320z" />
                    </svg>
                </button>
                <div class="dropdown-content">
                    <button id="download-btn" data-action="download">
                        <!-- Download icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="icon"
                            style="margin-right: .5rem;">
                            <path fill="currentColor"
                                d="M352 96C352 78.3 337.7 64 320 64C302.3 64 288 78.3 288 96L288 306.7L246.6 265.3C234.1 252.8 213.8 252.8 201.3 265.3C188.8 277.8 188.8 298.1 201.3 310.6L297.3 406.6C309.8 419.1 330.1 419.1 342.6 406.6L438.6 310.6C451.1 298.1 451.1 277.8 438.6 265.3C426.1 252.8 405.8 252.8 393.3 265.3L352 306.7L352 96zM160 384C124.7 384 96 412.7 96 448L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 448C544 412.7 515.3 384 480 384L433.1 384L376.5 440.6C345.3 471.8 294.6 471.8 263.4 440.6L206.9 384L160 384zM464 440C477.3 440 488 450.7 488 464C488 477.3 477.3 488 464 488C450.7 488 440 477.3 440 464C440 450.7 450.7 440 464 440z" />
                        </svg>
                        <span>Download</span>
                    </button>
                </div>
            </div>
                    </td>`;
                fragment.appendChild(tr);
            }
            tbody.appendChild(fragment);
            tbody.children[songIndex].classList.add("playing");
            previousRowActive = tbody.children[songIndex];
            scrollRowIntoView(previousRowActive);

            const dropdownBtn = d.querySelectorAll(".dropdown-btn");

            if (dropdownBtn) {
                for (let i = 0; i < dropdownBtn.length; i++) {
                    dropdownBtn[i].addEventListener("click", e => {
                        e.stopPropagation();
                        dropdownBtn[i].nextElementSibling.classList.toggle("show");
                    });
                }
            }

            // Close the dropdown if the user clicks outside of it
            window.onclick = function (e) {
                if (e.target.closest('.dropdown-btn')) return;
                const dropdowns = d.getElementsByClassName("dropdown-content");
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }

            // Dropdown download
            const dropdownContent = d.querySelectorAll(".dropdown-content");
            if (dropdownContent) {
                for (let i = 0; i < dropdownContent.length; i++) {
                    dropdownContent[i].addEventListener("click", e => {
                        const actionBtn = e.target.closest("[data-action]");
                        if (!actionBtn) return;
                        const action = actionBtn.dataset.action;
                        if (action === "download") {
                            // downloadSong(audioPlayer.src);
                            const songId = +actionBtn.closest("tr").dataset.songId;
                            downloadSong(audioSourcePath + playlistName + "/" + getSongById(songId).name);
                        }
                    });
                }
            }
        }

        tbody.addEventListener("click", e => {
            const tr = e.target.parentNode;
            if (tr.tagName !== "TR" || tr.classList.contains("playing")) return;
            if (previousRowActive) previousRowActive.classList.remove("playing");
            tr.classList.add("playing");
            previousRowActive = tr;

            if (!isShuffle) songIndex = tr.rowIndex;
            const song = getSongById(+tr.dataset.songId);

            audioPlayer.src = audioSourcePath + playlistName + "/" + song.name;
            audioPlayer.load();
            audioPlayer.preload = "metadata";

            audioPlayer.dataset.songId = song.id;
            artist.textContent = rmExt(song.name);

            setAnimation(artist);
            playAudio();

            d.body.style.background = `linear-gradient(to right, ${getRandomHexColor(32)}, ${getRandomHexColor(32)})`;
        });

        const getSongById = id => {
            return songs.find(song => song.id === id);
        }

        const updateRowActive = () => {
            if (previousRowActive) previousRowActive.classList.remove("playing");
            previousRowActive = tbody.querySelector(
                `tr[data-song-id="${songs[songIndex].id}"]`
            );
            previousRowActive.classList.add("playing");
            scrollRowIntoView(previousRowActive);
        }

        const scrollRowIntoView = row => {
            row.scrollIntoView({ behavior: "auto", block: "center" });
        }

        // let totalDuration = null;

        const updateDuration = () => {
            if (/*totalDuration === null && */isFinite(audioPlayer.duration) && audioPlayer.duration > 0) {
                // totalDuration = audioPlayer.duration;
                currentTime.textContent = "0:00";
                duration.textContent = formatTime(audioPlayer.duration);
                countdown.textContent = `-${formatTime(audioPlayer.duration - 0)}`;

                currentTimeSlider.max = audioPlayer.duration; // El maximo de la barra de progreso
                currentTimeSlider.value = 0; // Inicia en 0
            }
        }

        audioPlayer.addEventListener("loadedmetadata", updateDuration);
        audioPlayer.addEventListener("durationchange", updateDuration);

        audioPlayer.addEventListener("timeupdate", e => {
            // Esta condici√≥n evita el formato por ejemplo: -5:NaN
            if (isFinite(audioPlayer.duration) && audioPlayer.duration > 0) {
                currentTime.textContent = formatTime(audioPlayer.currentTime);
                currentTimeSlider.value = audioPlayer.currentTime;
                countdown.textContent = `-${formatTime(audioPlayer.duration - audioPlayer.currentTime)}`;
            }
        });

        currentTimeSlider.addEventListener("input", e => {
            if (currentTimeSlider.disabled) return;
            audioPlayer.currentTime = currentTimeSlider.value;
        });

        audioPlayer.addEventListener("ended", e => {
            if (songIndex >= numberOfSongs - 1 && !isRepeatAll) {
                playBtn.title = "Reproducir";

                playBtn.children[0].style.display = "inline";
                playBtn.children[1].style.display = "none";
                return;
            }
            forwardBtn.click();
            playAudio();
        });

        // Volume slider
        volumeSlider.addEventListener("input", () => {
            volumeDisplay.textContent = volumeSlider.value;
            audioPlayer.volume = volumeSlider.value / 100;
            if (volumeSlider.value === "0") {
                audioPlayer.muted = true;
                currentVolume = 0.5; // 50 %
                volumeBtn.title = "Activar sonido";

                volumeBtn.children[0].style.display = "none";
                volumeBtn.children[1].style.display = "inline";
            } else {
                audioPlayer.muted = false;
                currentVolume = volumeSlider.value / 100; //  Values are between 0 y 100
                volumeBtn.title = "Silenciar";

                volumeBtn.children[0].style.display = "inline";
                volumeBtn.children[1].style.display = "none";
            }
        });

        volumeBtn.addEventListener("click", () => {
            audioPlayer.muted = !audioPlayer.muted;
            if (audioPlayer.muted) {
                audioPlayer.volume = 0;
                volumeSlider.value = 0;
                volumeBtn.title = "Activar sonido";

                volumeBtn.children[0].style.display = "none";
                volumeBtn.children[1].style.display = "inline";
            } else {
                audioPlayer.volume = currentVolume; // Values are  between 0.1 and 1, where 1 = 100 %
                volumeSlider.value = currentVolume * 100; // Values are between 0 and 100
                volumeBtn.title = "Silenciar";

                volumeBtn.children[0].style.display = "inline";
                volumeBtn.children[1].style.display = "none";
            }
            volumeDisplay.textContent = volumeSlider.value;
        });

        const pauseAudio = () => {
            audioPlayer.pause();
            playBtn.title = "Reproducir";

            playBtn.children[0].style.display = "inline";
            playBtn.children[1].style.display = "none";
        };

        const playAudio = () => {
            audioPlayer.play().catch((error) => { });
            playBtn.title = "Pausar";

            playBtn.children[0].style.display = "none";
            playBtn.children[1].style.display = "inline";
        };

        // Controls
        playBtn.addEventListener("click", e => {
            if (audioPlayer.src === "") return;
            audioPlayer.paused ? playAudio() : pauseAudio();
        });

        forwardBtn.addEventListener("click", e => {
            if (audioPlayer.src === "") return;
            songIndex = (songIndex + 1) % numberOfSongs;
            if (!audioPlayer.paused) {
                loadSong(songIndex);
                playAudio();
            } else {
                loadSong(songIndex);
            }
            updateRowActive();
            // background: linear-gradient(to right, #6f0000, #200122);
            // https://uigradients.com
            d.body.style.background = `linear-gradient(to right, ${getRandomHexColor(32)}, ${getRandomHexColor(32)})`;
        });

        backwardBtn.addEventListener("click", e => {
            if (audioPlayer.src === "") return;
            songIndex = (songIndex - 1 + numberOfSongs) % numberOfSongs;
            if (!audioPlayer.paused) {
                loadSong(songIndex);
                playAudio();
            } else {
                loadSong(songIndex);
            }
            updateRowActive();
        });

        repeatBtn.addEventListener("click", e => {
            if (audioPlayer.src === "") return;
            repeatState = (repeatState + 1) % 3;
            if (repeatState === 0) {
                audioPlayer.loop = false;
                repeatBtn.title = "Repetir playlist";

                repeatBtn.children[1].style.display = "none";
                repeatBtn.children[0].style.display = "inline";
                return;
            }
            if (repeatState === 1) {
                isRepeatAll = true;
                repeatBtn.title = "Repetir canci√≥n indefinidamente";

                repeatBtn.children[0].querySelector("circle").style.display = "inline";
                return;
            }
            if (repeatState === 2) {
                isRepeatAll = false;
                audioPlayer.loop = true;
                repeatBtn.title = "Desactivar la repetici√≥n indefinida";

                repeatBtn.children[0].querySelector("circle").style.display = "none";
                repeatBtn.children[0].style.display = "none";

                repeatBtn.children[1].style.display = "inline";
                return;
            }
        });

        shuffleBtn.addEventListener("click", e => {
            if (audioPlayer.src === "") return;
            isShuffle = !isShuffle;
            if (isShuffle) {
                // Buscar el √≠ndice de la canci√≥n en reproducci√≥n
                const index = songs.findIndex(song => song.id === +(audioPlayer.dataset.songId));
                // Extraer o eliminar la canci√≥n del array
                const currentlyPlayingSong = songs.splice(index, 1)[0];
                // Mezclar el array sin la canci√≥n en reproducci√≥n
                shuffle(songs);
                // Insertar la canci√≥n en el √≠ndice cero despues de la mezcla
                songs.unshift(currentlyPlayingSong);
                // Seteamos songIndex a cero
                songIndex = 0;
                // console.table(songs);
                shuffleBtn.title = "Desactivar reproducci√≥n aleatoria";

                shuffleBtn.children[0].querySelector("circle").style.display = "inline";
            } else {
                songIndex = songsCopy.findIndex(song => song.id === +(audioPlayer.dataset.songId));
                songs = [...songsCopy];
                // console.table(songs);
                shuffleBtn.title = "Activar reproducci√≥n aleatoria";

                shuffleBtn.children[0].querySelector("circle").style.display = "none";
            }
        });

        // Format time in hh:mm:ss or mm:ss
        const formatTime = (seconds, format = 0) => {
            if (!isFinite(seconds) || seconds <= 0) return "0:00";

            // seconds = Math.round(seconds); // 59.6 seconds = 60, No usar
            seconds = seconds | 0; // or Math.floor(seconds);
            // const hours = Math.floor(seconds / 3600);
            const hours = (seconds / 3600) | 0; // Hours calculation
            // const minutes = Math.floor(seconds / 60) % 60; // forma 1
            // const minutes = Math.floor((seconds % 3600) / 60); // forma 2
            const minutes = ((seconds / 60) | 0) % 60; // Minutes calculation
            const remainingSeconds = seconds % 60; // Whole seconds

            if (format === 0) {
                return hours > 0
                    ? `${/*hours < 10 ? "0" + hours : */hours}:${minutes < 10 ? "0" + minutes : minutes}:${remainingSeconds < 10 ? "0" + remainingSeconds : remainingSeconds}`
                    : `${/*minutes < 10 ? "0" + minutes : */minutes}:${remainingSeconds < 10 ? "0" + remainingSeconds : remainingSeconds}`;
            }

            return hours > 0
                ? // Show hours minutes seconds format => 10 h 8 min 47 s
                `${hours} h ${minutes} min ${remainingSeconds} s`
                : // Show minutes seconds format => 8 min 47 s
                `${minutes} min ${remainingSeconds} s`;
        };

        // https://introcs.cs.princeton.edu/java/14array/Deck.java.html
        const shuffle = arr => {
            const len = arr.length;
            for (let i = 0; i < len; i++) {
                const r = i + parseInt(Math.random() * (len - i));
                [arr[i], arr[r]] = [arr[r], arr[i]];
            }
            return arr;
        };

        // Send request
        function sendHttpRequest(method, url, data, callback) {
            const xhr = getXhr();
            xhr.onreadystatechange = processRequest;
            function getXhr() {
                if (window.XMLHttpRequest) {
                    return new XMLHttpRequest();
                } else {
                    return new ActiveXObject("Microsoft.XMLHTTP");
                }
            }
            function processRequest() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    if (xhr.status == 200 && xhr.response != null) {
                        if (callback) callback(xhr.response);
                    } else {
                        console.log(
                            "There was a problem retrieving the data: " + xhr.statusText
                        );
                    }
                }
            }
            xhr.open(method, url + (/\?/.test(url) ? "&" : "?") + new Date().getTime());
            xhr.onloadstart = function (e) {
                /*openLoader();*/
            };
            xhr.onloadend = function (e) {
                /*closeLoader();*/
            };
            if (data && !(data instanceof FormData))
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.send(data);
            xhr.onerror = function (e) {
                console.log("Error: " + e + " Could not load url.");
            };
        }

        const parseName = name => {
            return `${name.slice(name.indexOf(' - ') + 3, -4)} - ${name.slice(0, name.indexOf(' - '))}`;
        }

        const rmExt = name => {
            return name.slice(0, -4);
        }

        const getRandomHexColor = (max = 256) => {
            if (0 > max || max > 256) return;
            return '#' +
                ((Math.random() * max) | 0).toString(16).padStart(2, '0') +
                ((Math.random() * max) | 0).toString(16).padStart(2, '0') +
                ((Math.random() * max) | 0).toString(16).padStart(2, '0');
        }

        const getPlaylistDuration = songs => {
            let totalSeconds = 0, len = songs.length;
            for (let i = 0; i < len; i++) {
                totalSeconds += songs[i].duration;
            }
            return formatTime(totalSeconds, 1);
        }

        const downloadSong = async url => {

            const decodeURI = decodeURIComponent(url);
            const name = decodeURI.slice(decodeURI.lastIndexOf("/") + 1, -4);

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
                const contentType = response.headers.get('Content-Type');

                const blob = await response.blob();
                const blobUrl = URL.createObjectURL(blob);

                const a = d.createElement('a');
                a.href = blobUrl;
                a.download = name;
                a.click();

                URL.revokeObjectURL(blobUrl);
            } catch (error) {
                console.error('Error al descargar el archivo:', error);
            }

        }

        // End dropdown download

    </script>

    <!-- https://www.youtube.com/watch?v=PDsLvd3lnK0 -->
    <!--  -->
</body>

</html>